# Issues Helper: ë¼ë²¨ ì—†ìŒ ì‹œ ëŒ“ê¸€ ì•ˆë‚´ â†’ ë¼ë²¨ ë‹¬ë¦¬ë©´ í•´ë‹¹ ëŒ“ê¸€ ì‚­ì œ í›„ í™˜ì˜ ëŒ“ê¸€
# https://github.com/marketplace/actions/issues-helper
name: Issue Helper

on:
  issues:
    types: [opened, labeled]

jobs:
  # ì´ìŠˆ ìƒì„± ì‹œ
  on-opened:
    if: github.event_name == 'issues' && github.event.action == 'opened'
    runs-on: ubuntu-latest
    steps:
      # ë¼ë²¨ ì—†ì„ ë•Œë§Œ â€” ë¼ë²¨ ë¶™ì—¬ ë‹¬ë¼ëŠ” ëŒ“ê¸€ (ë‚˜ì¤‘ì— ì°¾ê¸° ìœ„í•´ ë§ˆì»¤ í¬í•¨)
      - name: Remind to add label when none
        if: github.event.issue.labels == fromJSON('[]')
        uses: actions-cool/issues-helper@v3
        with:
          actions: 'create-comment'
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.issue.number }}
          body: |
            âš ï¸ ì´ ì´ìŠˆì—ëŠ” ì•„ì§ **ë¼ë²¨ì´ ì—†ìŠµë‹ˆë‹¤.**  
            ì´ìŠˆ ìœ í˜•ì— ë§ëŠ” ë¼ë²¨ì„ ë¶™ì—¬ ì£¼ì„¸ìš”: `feat` / `fix` / `docs` / `refactor` / `chore`
            <!-- reminder-no-label -->
          emoji: 'eyes'

      # ì²˜ìŒë¶€í„° ë¼ë²¨ì´ ìˆìœ¼ë©´ â€” í™˜ì˜ ëŒ“ê¸€ë§Œ
      - name: Create welcome comment (had labels from start)
        if: github.event.issue.labels != fromJSON('[]')
        uses: actions-cool/issues-helper@v3
        with:
          actions: 'create-comment'
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.issue.number }}
          body: |
            ì•ˆë…•í•˜ì„¸ìš” @${{ github.event.issue.user.login }}ë‹˜, ì´ìŠˆë¥¼ ë“±ë¡í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ğŸ™Œ

            - **ì»¤ë°‹Â·PR**: [ì»¤ë°‹ ì»¨ë²¤ì…˜](https://github.com/GDG-on-Campus-KNU/winter-sprint-5.5st-team1-be/blob/main/.github/commit_convention.md)ì„ ì°¸ê³ í•´ ì£¼ì„¸ìš”.

            ê°ì‚¬í•©ë‹ˆë‹¤.
          emoji: '+1'

  # ë¼ë²¨ì´ ë¶™ì—ˆì„ ë•Œ â€” ì•ˆë‚´ ëŒ“ê¸€ ì‚­ì œ í›„ í™˜ì˜ ëŒ“ê¸€
  on-labeled:
    if: github.event_name == 'issues' && github.event.action == 'labeled'
    runs-on: ubuntu-latest
    steps:
      # ìš°ë¦¬ê°€ ë‹¨ "ë¼ë²¨ ì—†ìŒ" ì•ˆë‚´ ëŒ“ê¸€ ì°¾ê¸°
      - name: Find reminder comment
        id: find_reminder
        uses: actions-cool/issues-helper@v3
        with:
          actions: 'find-comments'
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.issue.number }}
          body-includes: 'reminder-no-label'

      # ì°¾ì€ ì•ˆë‚´ ëŒ“ê¸€ì˜ id ì¶”ì¶œ (ì²« ë²ˆì§¸ë§Œ)
      - name: Get reminder comment id
        id: get_comment_id
        if: steps.find_reminder.outputs.comments != '' && steps.find_reminder.outputs.comments != '[]'
        run: |
          comment_id=$(echo '${{ steps.find_reminder.outputs.comments }}' | jq -r '.[0].id')
          echo "comment_id=$comment_id" >> $GITHUB_OUTPUT

      # ì°¾ì€ ì•ˆë‚´ ëŒ“ê¸€ ì‚­ì œ (ìˆì„ ë•Œë§Œ)
      - name: Delete reminder comment
        if: steps.get_comment_id.outputs.comment_id != ''
        uses: actions-cool/issues-helper@v3
        with:
          actions: 'delete-comment'
          token: ${{ secrets.GITHUB_TOKEN }}
          comment-id: ${{ steps.get_comment_id.outputs.comment_id }}

      # í™˜ì˜ ëŒ“ê¸€ ë‹¬ê¸° (ì•ˆë‚´ ëŒ“ê¸€ì´ ìˆì—ˆì„ ë•Œë§Œ = ë°©ê¸ˆ ë¼ë²¨ì„ ë¶™ì¸ ê²½ìš°)
      - name: Create welcome comment
        if: steps.get_comment_id.outputs.comment_id != ''
        uses: actions-cool/issues-helper@v3
        with:
          actions: 'create-comment'
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.issue.number }}
          body: |
            ì•ˆë…•í•˜ì„¸ìš” @${{ github.event.issue.user.login }}ë‹˜, ì´ìŠˆë¥¼ ë“±ë¡í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ğŸ™Œ

            - **ì»¤ë°‹Â·PR**: [ì»¤ë°‹ ì»¨ë²¤ì…˜](https://github.com/GDG-on-Campus-KNU/winter-sprint-5.5st-team1-be/blob/main/.github/commit_convention.md)ì„ ì°¸ê³ í•´ ì£¼ì„¸ìš”.

            ê°ì‚¬í•©ë‹ˆë‹¤.
          emoji: '+1'
